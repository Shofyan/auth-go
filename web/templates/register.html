{{define "content"}}
<h1>Create Account</h1>
<p>Sign up for a new account</p>

<div id="message"></div>

<form id="registerForm">
    <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required placeholder="your@email.com">
    </div>

    <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" required 
               placeholder="Minimum 8 characters" minlength="8">
        <small style="color: #666; font-size: 12px;">Must include uppercase, lowercase, and number (min 8 characters)</small>
    </div>

    <div class="form-group">
        <label>Roles</label>
        <div style="display: flex; flex-direction: column; gap: 8px;">
            <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                <input type="checkbox" name="roles" value="user" checked style="margin-right: 8px;">
                User - Basic access to the system
            </label>
            <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                <input type="checkbox" name="roles" value="moderator" style="margin-right: 8px;">
                Moderator - Can moderate content
            </label>
            <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                <input type="checkbox" name="roles" value="admin" style="margin-right: 8px;">
                Admin - Full system access
            </label>
        </div>
        <small style="color: #666; font-size: 12px;">Select one or more roles for this account</small>
    </div>

    <button type="submit" id="registerBtn">
        Create Account
    </button>
</form>

<div class="link">
    Already have an account? <a href="/web/login">Sign in</a>
</div>

<script>
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const btn = document.getElementById('registerBtn');
        btn.disabled = true;
        btn.style.background = '#333';
        btn.textContent = 'Creating account...';
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const roleCheckboxes = document.querySelectorAll('input[name="roles"]:checked');
        const roles = Array.from(roleCheckboxes).map(cb => cb.value);
        
        try {
            const response = await fetch('/api/v1/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password, roles })
            });
            
            if (response.ok) {
                document.getElementById('message').innerHTML = 
                    '<div class="success">Registration successful! Redirecting to login...</div>';
                setTimeout(() => window.location.href = '/web/login', 2000);
            } else {
                const data = await response.json();
                document.getElementById('message').innerHTML = 
                    `<div class="error">${data.error || 'Registration failed'}</div>`;
                btn.disabled = false;
                btn.style.background = '';
                btn.textContent = 'Create Account';
            }
        } catch (error) {
            document.getElementById('message').innerHTML = 
                '<div class="error">Network error. Please try again.</div>';
            btn.disabled = false;
            btn.style.background = '';
            btn.textContent = 'Create Account';
        }
    });
</script>
{{end}}
